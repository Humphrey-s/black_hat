#include <stdio.h>
#include <windows.h>
#include <stdlib.h>
#include <tlhelp32.h>
#include <string.h>
#include <wchar.h>

DWORD get_processes(wchar_t *proc_name);
LPVOID allocate_memory(DWORD remote_pid);

int main(void)
{
	wchar_t *process = L"Discord.exe";
	DWORD PID = get_processes(process);
	LPVOID mem_address = allocate_memory(PID);

	printf("%ld allocated memory %p\n", PID, mem_address);

return (0);
}
/**
 * get_processes - gets processes in windows
 * @process: process to be got
 * Return: PID of process
 */
DWORD get_processes(wchar_t *proc_name)
{
	DWORD remote_pid;
	HANDLE hsnapshot;
	PROCESSENTRY32W entry;
	entry.dwSize = sizeof(PROCESSENTRY32W);

	hsnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
	
	if (Process32FirstW(hsnapshot, &entry))
	{
		do
		{
	
		if (!wcsicmp(proc_name, entry.szExeFile))
		{
			remote_pid = entry.th32ProcessID;
			break;
		}
	
		}
		while (Process32NextW(hsnapshot, &entry) == TRUE);

	}
	CloseHandle(hsnapshot);
return (remote_pid);
}
/**
 * allocate_memory - allocates memory in remote pid and writes to the address
 * @remote_pid: process id
 * Return: address (SUCCESS) ELSE (0)
 */
LPVOID allocate_memory(DWORD remote_pid)
{
	HANDLE process_handle;
	LPVOID allocated_memory;
	LPCVOID str = "MALWARE ANALYSIS";

	process_handle = OpenProcess(PROCESS_ALL_ACCESS, TRUE, remote_pid);

	allocated_memory = VirtualAllocEx(process_handle, NULL, 4096, MEM_COMMIT, PAGE_EXECUTE_READWRITE);

	if (allocated_memory == NULL)
	{
	return (0);
	}
	else
	{
	WriteProcessMemory(process_handle, allocated_memory, str, (SIZE_T)(strlen(str) + 1), NULL);
	return (allocated_memory);
	}
}
